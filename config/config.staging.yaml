# Staging Environment Configuration
# For pre-production testing with full security and moderate load

server:
  host: 0.0.0.0
  port: 8443
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s
  shutdown_timeout: 30s
  max_header_bytes: 1048576
  gin_mode: release

redis:
  mode: sentinel
  addresses:
    - redis-staging-sentinel-0.redis:26379
    - redis-staging-sentinel-1.redis:26379
    - redis-staging-sentinel-2.redis:26379
  master_name: mymaster
  password: ${REDIS_PASSWORD}  # From Kubernetes secret
  db: 0
  pool_size: 20
  min_idle_conns: 5
  max_retries: 5
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s
  pool_timeout: 4s
  idle_timeout: 5m
  enable_tls: true
  tls_insecure_skip_verify: false

kubernetes:
  config_path: ""  # Use in-cluster config
  context: ""
  namespace: ""  # All namespaces
  qps: 50.0
  burst: 100
  timeout: 30s
  enable_watch: true
  watch_resync: 10m

tls:
  enabled: true
  cert_file: /etc/certs/tls.crt
  key_file: /etc/certs/tls.key
  ca_file: /etc/certs/ca.crt
  client_auth: require-and-verify  # mTLS enabled
  min_version: "1.3"
  cipher_suites: []

observability:
  logging:
    level: info
    format: json
    output_paths:
      - stdout
    error_output_paths:
      - stderr
    enable_caller: true
    enable_stacktrace: false
    development: false

  metrics:
    enabled: true
    path: /metrics
    port: 0  # Use main server port
    namespace: netweave
    subsystem: gateway
    enable_go_metrics: true
    enable_process_metrics: true

  tracing:
    enabled: true
    provider: otlp
    endpoint: http://jaeger-collector.observability.svc:4318
    service_name: netweave-gateway-staging
    sampling_rate: 0.5  # 50% sampling for staging
    enable_batching: true
    batch_timeout: 5s

security:
  enable_cors: true
  allowed_origins:
    - https://staging.example.com
  allowed_methods:
    - GET
    - POST
    - PUT
    - PATCH
    - DELETE
  allowed_headers:
    - Content-Type
    - Authorization
    - X-Request-ID
  rate_limit_enabled: true
  rate_limit:
    tenant:
      requests_per_second: 50  # Lower limits for staging
      burst_size: 100
    global:
      requests_per_second: 500
      max_concurrent_requests: 200
    endpoints: []

validation:
  enabled: true
  validate_response: false
  spec_path: ""
  max_body_size: 1048576  # 1MB

multi_tenancy:
  enabled: true
  require_mtls: true
  initialize_default_roles: true
  audit_log_retention_days: 30
  skip_auth_paths:
    - /health
    - /healthz
    - /ready
    - /readyz
    - /metrics
    - /
    - /o2ims
  default_tenant_quota:
    max_subscriptions: 50
    max_resource_pools: 25
    max_deployments: 100
    max_users: 10
    max_requests_per_minute: 500
