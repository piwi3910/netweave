# Production Environment Configuration
# For production deployment with maximum security and high availability

server:
  host: 0.0.0.0
  port: 8443
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s
  shutdown_timeout: 30s
  max_header_bytes: 1048576
  gin_mode: release

redis:
  mode: sentinel
  addresses:
    - redis-prod-sentinel-0.redis:26379
    - redis-prod-sentinel-1.redis:26379
    - redis-prod-sentinel-2.redis:26379
  master_name: mymaster
  password: ${REDIS_PASSWORD}  # From Kubernetes secret
  db: 0
  pool_size: 50
  min_idle_conns: 10
  max_retries: 5
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s
  pool_timeout: 4s
  idle_timeout: 5m
  enable_tls: true
  tls_insecure_skip_verify: false

kubernetes:
  config_path: ""  # Use in-cluster config
  context: ""
  namespace: ""  # All namespaces
  qps: 100.0
  burst: 200
  timeout: 30s
  enable_watch: true
  watch_resync: 10m

tls:
  enabled: true
  cert_file: /etc/certs/tls.crt
  key_file: /etc/certs/tls.key
  ca_file: /etc/certs/ca.crt
  client_auth: require-and-verify  # Strict mTLS required
  min_version: "1.3"
  cipher_suites: []  # Use Go defaults (secure cipher suites)

observability:
  logging:
    level: info
    format: json
    output_paths:
      - stdout
    error_output_paths:
      - stderr
    enable_caller: true
    enable_stacktrace: false
    development: false

  metrics:
    enabled: true
    path: /metrics
    port: 0  # Use main server port
    namespace: netweave
    subsystem: gateway
    enable_go_metrics: true
    enable_process_metrics: true

  tracing:
    enabled: true
    provider: otlp
    endpoint: http://jaeger-collector.observability.svc:4318
    service_name: netweave-gateway-prod
    sampling_rate: 0.1  # 10% sampling for production efficiency
    enable_batching: true
    batch_timeout: 5s

security:
  enable_cors: false  # CORS disabled in production
  allowed_origins: []
  allowed_methods:
    - GET
    - POST
    - PUT
    - PATCH
    - DELETE
  allowed_headers:
    - Content-Type
    - Authorization
    - X-Request-ID
  rate_limit_enabled: true
  rate_limit:
    tenant:
      requests_per_second: 100
      burst_size: 200
    global:
      requests_per_second: 1000
      max_concurrent_requests: 500
    endpoints:
      # High-traffic endpoints with specific limits
      - path: /o2ims/v1/subscriptions
        method: POST
        requests_per_second: 10
        burst_size: 20
      - path: /o2ims/v1/resourcePools
        method: GET
        requests_per_second: 100
        burst_size: 200
    resource:
      enabled: true  # Resource-type rate limiting enabled in production
      deployment_managers:
        reads_per_minute: 100
        writes_per_minute: 10
        list_page_size_max: 100
      resource_pools:
        reads_per_minute: 500
        writes_per_minute: 50
        list_page_size_max: 100
      resources:
        reads_per_minute: 1000
        writes_per_minute: 100
        list_page_size_max: 100
      resource_types:
        reads_per_minute: 200
        writes_per_minute: 0  # Resource types are read-only
        list_page_size_max: 100
      subscriptions:
        creates_per_hour: 100
        max_active: 50
        reads_per_minute: 200

validation:
  enabled: true
  validate_response: false  # Disable in production for performance
  spec_path: ""
  max_body_size: 1048576  # 1MB

multi_tenancy:
  enabled: true
  require_mtls: true
  initialize_default_roles: true
  audit_log_retention_days: 90  # Longer retention for compliance
  skip_auth_paths:
    - /health
    - /healthz
    - /ready
    - /readyz
    - /metrics
    - /
    - /o2ims
  default_tenant_quota:
    max_subscriptions: 100
    max_resource_pools: 50
    max_deployments: 200
    max_users: 20
    max_requests_per_minute: 1000
