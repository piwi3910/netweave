---
# ConfigMap for O2-IMS Gateway configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: netweave-config
  namespace: o2ims-system
  labels:
    app.kubernetes.io/name: netweave
    app.kubernetes.io/component: gateway
    app.kubernetes.io/part-of: o2ims
data:
  config.yaml: |
    # O2-IMS Gateway Configuration

    # Server Configuration
    server:
      host: 0.0.0.0
      port: 8080
      read_timeout: 30s
      write_timeout: 30s
      idle_timeout: 120s
      shutdown_timeout: 30s
      max_header_bytes: 1048576  # 1MB
      gin_mode: release

    # Redis Configuration
    redis:
      mode: standalone
      addresses:
        - redis-master.o2ims-system.svc.cluster.local:6379
      db: 0
      pool_size: 10
      min_idle_conns: 5
      max_retries: 3
      dial_timeout: 5s
      read_timeout: 3s
      write_timeout: 3s
      pool_timeout: 4s
      idle_timeout: 5m
      enable_tls: false
      tls_insecure_skip_verify: false

    # Kubernetes Configuration
    kubernetes:
      # Use in-cluster config (empty config_path)
      config_path: ""
      namespace: ""
      qps: 50.0
      burst: 100
      timeout: 30s
      enable_watch: true
      watch_resync: 10m

    # TLS/mTLS Configuration
    tls:
      enabled: false
      # cert_file: /etc/netweave/tls/tls.crt
      # key_file: /etc/netweave/tls/tls.key
      # ca_file: /etc/netweave/tls/ca.crt
      client_auth: none
      min_version: "1.3"

    # Observability Configuration
    observability:
      logging:
        level: info
        format: json
        output_paths:
          - stdout
        error_output_paths:
          - stderr
        enable_caller: true
        enable_stacktrace: false
        development: false

      metrics:
        enabled: true
        path: /metrics
        port: 0
        namespace: netweave
        subsystem: gateway
        enable_go_metrics: true
        enable_process_metrics: true

      tracing:
        enabled: false
        provider: otlp
        service_name: netweave-gateway
        sampling_rate: 0.1
        enable_batching: true
        batch_timeout: 5s

    # Security Configuration
    security:
      enable_cors: false
      allowed_methods:
        - GET
        - POST
        - PUT
        - PATCH
        - DELETE
      rate_limit_enabled: true
      rate_limit_requests: 100
      rate_limit_window: 1m
